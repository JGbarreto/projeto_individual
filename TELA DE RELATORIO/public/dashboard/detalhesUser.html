<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/styleDash.css">
    <link rel="icon" type="image/x-icon" href="assets/LogoSimbolo.png">
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <title>SAMP</title>
</head>

<body onload="validarSessao(),buscarComponentesUser(sessionStorage.USUARIO_ANALISE, sessionStorage.ID_MAQUINA)">

    <div class="header_dash">
        <nav class="nav_dash">
            <!-- <img src="../assets/icons/burger-bar.png" class="icon-menu"> -->
            <img src="../assets/logobranca.png">
        </nav>

    </div>

    <div class="menu" id="sidebar">

        <h2 id="nome_empresa">C6</h2>
        <ul id="ul_maquinas">
            <!--  <li class="item-selecionado">
                <a><img src="../assets/icons/server.png">Servidor 01</a>
            </li>
            <li>
                <a><img src="../assets/icons/server.png">Servidor 02</a>
            </li>
            <li>
                <a><img src="../assets/icons/server.png">Servidor 03</a>
            </li>
            <li>
                <a><img src="../assets/icons/server.png">Servidor 04</a>
            </li>-->
            <li>
                <a href="analise.html"><img src="../assets/icons/bar-chart.png">An치lise</a>
            </li>
            <li>
                <a href="users.html"><img src="../assets/icons/add-user.png">Funcion치rios</a>
            </li>
        </ul>
        <ul>
            <li>
                <a onclick="limparSessao()"><img src="../assets/icons/log-out.png">Sair</a>
            </li>
        </ul>

    </div>

    </div>

    <div class="dash">



        <div class="main">
            <h2 id="nome_usuario">Usu치rio</h2>
            <div class="container">
                <h2>M치quina</h2>
                <select name="maquina" id="slct_maquinas"
                    onchange="sessionStorage.ID_MAQUINA=slct_maquinas.value" ></select>
                <button onclick="window.location.reload()" id="botao_analisar">Analisar</button>
                <div class="relatorio_user">
                    <div class="fr1_relatorio">
                        <div class="qtd_dados" id="qtd_dados">
                            <canvas id="grafico_qtd_dados"></canvas>
                        </div>
                        <div class="valor_dados" id="valor_dados">
                            <canvas id="grafico_valor_dados"></canvas>
                        </div>
                    </div>
                    <div class="fr2_relatorio">
                        <div class="dados_gerais" id="dados_gerais">
                            <div class="dados_gerais1">
                                <div>
                                    <h2>Servidores monitorados: <h1>6</h1>
                                    </h2>
                                </div>
                                <div>
                                    <h2>Numero de alertas</h2>
                                    <h1>2</h1>
                                </div>
                            </div>
                            <div class="dados_gerais2">
                                <div>
                                    <h2>Tempo de atividade</h2>
                                    <h2>5 dias, e 3 horas</h2>
                                </div>
                                <div>
                                    
                                </div>
                            </div>
                        </div>
                        <div class="participacao" id="participacao">
                            <canvas id="grafico_participacao"></canvas>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../js/plotarGraficos.js"></script>
<script src="../js/funcoes.js"></script>
<script src="../js/sidebar.js"></script>
<script>
    
    fetch("/medidas/buscarServidores", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idEmpresa: idEmpresa
        })
    }).then(function (resposta) {
        if (resposta.ok) {

            resposta.json().then(json => {

                console.log(JSON.stringify(json));
                console.log(json);

                for (var index = 0; index < json.length; index++) {

                    idMaquina = json[index].idMaquina;
                    serialMaquina = json[index].serialMaquina;
                    nomeMaquina = json[index].nome;
                    fkEmpresa = json[index].fkEmpresa;

                    var idBotao = `maquina${idMaquina}`;

                    var paginaAtual = window.location.href;

                    var link = '';

                    if (paginaAtual == "http://localhost:8080/dashboard/dashboard.html" || paginaAtual == "http://localhost:8080/dashboard/dashboard.html#") {
                        link = '#';
                    } else {
                        link = 'dashboard.html';
                    }

                    slct_maquinas.innerHTML += `
                            <option value='${idMaquina}'>${nomeMaquina}</option>
                        `
                }

            })


        }


    })

    var idEmpresa = sessionStorage.ID_EMPRESA;

    fetch("/usuarios/buscarFuncionarios", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            idEmpresa: idEmpresa
        })
    }).then(function (resposta) {
        if (resposta.ok) {

            resposta.json().then(json => {

                console.log(JSON.stringify(json));
                console.log(json);

                for (var index = 0; index < json.length; index++) {

                    idUsuario = json[index].idUsuario;
                    nome = json[index].nome;
                    email = json[index].email;
                    cargo = json[index].cargo;

                    if(idUsuario == sessionStorage.USUARIO_ANALISE) {
                        nome_usuario.innerHTML =nome;
                    }
                }

            })


        }


    })
    function definirSessao() {
        slct_maquinas.selectedIndex = sessionStorage.ID_MAQUINA - 1;
        slct_user.selectedIndex = sessionStorage.USUARIO_ANALISE - 1; 
         
        }

        setTimeout(definirSessao, 150)

</script>